paths:
  /users:
    post:
      operationId: create_user
      summary: Create user
      description: '**Required ACL:** `confd.users.create`'
      tags:
      - users
      parameters:
      - $ref: '#/parameters/tenant_uuid_required'
      - name: body
        in: body
        description: User to create with all the associated resources
        required: true
        schema:
          $ref: '#/definitions/UserRequest'
      responses:
        '201':
          description: User created with all the associated resources
          schema:
            $ref: '#/definitions/UserResponse'

parameters:
  tenant_uuid_required:
    name: Wazo-Tenant
    type: string
    in: header
    description: "The tenant's UUID, defining the ownership of a given resource."
    required: true

definitions:
  User:
    title: User
    allOf:
    - $ref: '#/definitions/UserRelationBase'
    - properties:
        id:
          type: integer
          description: User ID
          readOnly: true
        email:
          type: string
          description: User's email. Used for directories (i.e. by wazo-dird)
        timezone:
          type: string
          description: User timezone
        language:
          type: string
          enum:
          - de_DE
          - en_US
          - es_ES
          - fr_FR
          - fr_CA
          - it_IT
          - nl_NL
          description: User language (e.g. "en_US")
        description:
          type: string
          description: Additional information about the user
        call_transfer_enabled:
          type: boolean
          default: false
          description: Authorize call transfers
        dtmf_hangup_enabled:
          type: boolean
          default: false
          description: Authorize to hangup with DTMF
        call_record_enabled:
          type: boolean
          default: false
          description: Record all calls made by this user (deprecated). If set, all `call_record_*_enabled` will be affected
        call_record_outgoing_external_enabled:
          type: boolean
          default: false
          description: Record all external calls made by this user
        call_record_incoming_external_enabled:
          type: boolean
          default: false
          description: "Record all external calls received by this user."
        call_record_outgoing_internal_enabled:
          type: boolean
          default: false
          description: Record all internal calls received by this user
        call_record_incoming_internal_enabled:
          type: boolean
          default: false
          description: "Record all internal calls received by this user."
        online_call_record_enabled:
          type: boolean
          default: false
          description: Allow user to record a call by pressing *3
        caller_id:
          type: string
          description: Name that appears on the phone when calling. Formatted as "Firstname
            Lastname" < number >
        outgoing_caller_id:
          type: string
          enum:
          - default
          - anonymous
          - '"Firstname Lastname" < number >'
          description: Name that appears on the phone when calling
        mobile_phone_number:
          type: string
          description: Phone number for the userâ€™s mobile device
        username:
          type: string
          description: Username for connecting to the CTI (deprecated)
        password:
          type: string
          minLength: 4
          description: Password for connecting to the CTI (deprecated)
        music_on_hold:
          type: string
          description: Name of the MOH category to use for music on hold
        ring_seconds:
          type: integer
          default: 30
          description: Number of seconds a user's phone will ring before falling back
        simultaneous_calls:
          type: integer
          default: 5
          description: Number of allowed simultaneous calls on a user's phone
        supervision_enabled:
          type: boolean
          default: true
          description: Activate presence sharing in the xivo client
        preprocess_subroutine:
          type: string
          description: Name of the subroutine to execute in asterisk before receiving
            a call
        userfield:
          type: string
          description: A custom field which purpose is left to the client. If the user
            has no userfield, then this field is an empty string.
        call_permission_password:
          type: string
          description: Overwrite all passwords set in call permissions associated to
            the user
        enabled:
          type: boolean
          default: true
          description: Enable/Disable the user
        tenant_uuid:
          type: string
          description: The UUID of the tenant
          readOnly: true
    - $ref: '#/definitions/UserRelationAgent'
    - $ref: '#/definitions/UserRelationFallbacks'
    - $ref: '#/definitions/UserRelationForwards'
    - $ref: '#/definitions/UserRelationGroups'
    - $ref: '#/definitions/UserRelationIncalls'
    - $ref: '#/definitions/UserRelationLines'
    - $ref: '#/definitions/UserRelationServices'
    - $ref: '#/definitions/UserRelationSwitchboards'
    - $ref: '#/definitions/UserRelationVoicemail'
    - $ref: '#/definitions/UserRelationQueues'
    - $ref: '#/definitions/UserRelationCallPickupTargets'
    - required:
      - firstname
  UserRelationBase:
    properties:
      uuid:
        type: string
        description: User UUID. This ID is globally unique across multiple Wazo instances
        readOnly: true
      firstname:
        type: string
        description: User firstname
      lastname:
        type: string
        description: User lastname
  UserRelationGroups:
    properties:
      groups:
        type: array
        readOnly: true
        items:
          $ref: '#/definitions/GroupRelationBase'
  UserRelationIncalls:
    properties:
      incalls:
        type: array
        readOnly: true
        items:
          $ref: '#/definitions/UserRelationIncall'
  UserRelationIncall:
    allOf:
      - $ref: '#/definitions/IncallRelationBase'
      - $ref: '#/definitions/IncallRelationExtensions'
  UserRelationLines:
    properties:
      lines:
        type: array
        readOnly: true
        items:
          $ref: '#/definitions/UserRelationLine'
  UserRelationLine:
    allOf:
      - $ref: '#/definitions/LineRelationBase'
      - $ref: '#/definitions/LineRelationEndpoints'
      - $ref: '#/definitions/LineRelationExtensions'
  UserRelationFallbacks:
    properties:
      fallbacks:
        readOnly: true
        $ref: '#/definitions/UserFallbacks'
  UserRelationForwards:
    properties:
      forwards:
        readOnly: true
        $ref: '#/definitions/UserForwards'
  UserRelationServices:
    properties:
      services:
        readOnly: true
        $ref: '#/definitions/UserServices'
  UserRelationSwitchboards:
    properties:
      switchboards:
        type: array
        readOnly: true
        items:
          $ref: '#/definitions/SwitchboardRelationBase'
  UserRelationVoicemail:
    properties:
      voicemail:
        readOnly: true
        $ref: '#/definitions/VoicemailRelationBase'
  UserRelationQueues:
    properties:
      queues:
        type: array
        readOnly: true
        items:
          $ref: '#/definitions/QueueRelationBase'
  UserRelationAgent:
    properties:
      agent:
        readOnly: true
        $ref: '#/definitions/AgentRelationBase'
  UserRequest:
    title: Unified User
    properties:
        user:
          type: object
          description: User Section
          $ref: '#/definitions/User'
        voicemail:
          type: object
          description: Voicemail Section
          $ref: '#/definitions/Voicemail'
        lines:
          type: array
          items:
            description: Line Section
            $ref: '#/definitions/LineView'
  UserRelationCallPickupTargets:
    title: UserRelationCallPickupTargets
    properties:
      call_pickup_target_users:
        type: array
        items:
          $ref: '#/definitions/UserRelationBase'
  UserResponse:
    title: Unified User
    properties:
        user:
          type: object
          description: User Section
          $ref: '#/definitions/User'
        voicemail:
          type: object
          description: Voicemail Section
          $ref: '#/definitions/Voicemail'
        line:
          type: object
          description: Line Section
          $ref: '#/definitions/Line'
  UserServices:
    title: UserServices
    properties:
      dnd:
        $ref: '#/definitions/UserService'
      incallfilter:
        $ref: '#/definitions/UserService'
  UserService:
    title: UserService
    properties:
      enabled:
        type: boolean
    required:
    - enabled
  UserForward:
    title: UserForward
    properties:
      enabled:
        type: boolean
      destination:
        type: string
  UserForwards:
    title: UserForwards
    properties:
      busy:
        $ref: '#/definitions/UserForward'
      noanswer:
        $ref: '#/definitions/UserForward'
      unconditional:
        $ref: '#/definitions/UserForward'
